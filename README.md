# 出席管理アプリ
とある塾の自習室の出席管理システムとして作成したアプリです。  
Create-react-appで作成したアプリのひな型に、electronでwindowsデスクトップアプリケーションとしてビルドしています。  
動作環境：windows 10(x64)上のみ動作を確認、Linux、mac上ではインストールできません。  

最新安定バージョン：0.9.7

## 最新更新情報
### ver 0.9.8(nightly) (2021/8/29)
#### 1. これまでapp.config.jsから設定していた項目を、アプリの設定メニューからGUIで変更できる様になりました  
新たに「アプリ1日分内部データ削除機能」と、「直前操作取り消し機能」を、設定画面から有効化/無効化できるようになりました。  
実装途中の機能です。今後、内部的な仕様は変更予定です。


#### 2. 同様に、手動で設定する項目に関して、ローカルファイルへバックアップを取るようになりました。  
検証不足なため、不安定な恐れのある機能です。stable版をお待ち下さい。

#### 3. アプリ起動時、バックアップしているアプリ設定項目を自動で復元する機能を追加しました。  
検証不足なため、不安定な恐れのある機能です。stable版をお待ち下さい。

**nightly版はそのままではビルドできないため、以下の2点を変更した上で`npm run build`を実行してください。**  
+ package.jsonのmainプロパティを`"main":"build/electron/main.js"`へ変更  
+ package.jsonのversionプロパティを`"version": "0.9.8"`へ変更

### ver 0.9.7.1 (2021/8/29)  
取り消し周りのUIを改善しました。  
ビルドする場合、`npm start`コマンドを使用するか、  
package.jsonの`main: public/electron/main.js`を`main: build/electron/main.js`に変更してから`npm run build`コマンドを実行してください。

### ver 0.9.7 (2021/8/28)  
メジャーバージョンアップを行いました。機能的にはあらかた実装したので、  
もう少し調整後、様子を見つつβ版から製品版の1.0.0に引き上げようと思います。  
ちなみに、以下の"nightly"と"stable"はそれぞれ実験的段階の機能、安定版の機能を表します。    

### 追加機能一覧  

#### 1. src/app.config.js 内で、アプリ内の各種機能を任意で有効化/無効化できる機能を開放 
アプリの不具合対策その１。もし明らかに動作に支障をきたす機能がある場合、ユーザーの方で指定して、該当機能を無効化できる。  
現時点ではビルド前に行いましょう。将来的には、アプリ設定メニューから変更し、ローカルに設定を保持する予定です。  
その他、詳しくはsrc/app.config.js内に記載した説明を御覧ください。  

#### 2. 直前の操作の取り消し機能を実装 **(nightly)**  
まだ実験段階の機能ですが、普通に動くので実装。  
src/app.config.jsの設定で無効化可能。  
まだボタンのスタイルとかが指定できていないので、微調整します。  


#### 3. 「退出する」モーダルにおいて、8人以上表示されるとスクロールできるように指定  
指摘があったので修正。UI的に、スクロールバーを表示できるようにするつもりですが、  
問題発生中につき一次保留にしてます。次回調整。  

#### 4. アプリ設定内に、1日分の内部データをリセット(削除)する機能を実装 **(stable)**  
アプリの不具合対策その２。  
アプリ設定から呼び出せる機能で、アプリを稼働している日の１日分の内部データのみ削除を行う。  
内部データとは、seatsState, attendanceStateなど、バックアップデータ全般。  
(~/user/AppData/Roaming/attendance-management/appLocalData/　の内部に保存されてるやつ)  

もしアプリが正常に動作しない場合は、内部データのリセットで解決できるかも、ということで実装  
ただし、一度消したデータは復元不可能  

#### 5. アプリケーションの部分的なコードを整形・変更  
#### 6. バックアップ機能において、潜在的にフラグが更新されないバグが有ったので修正  

以上です。次回の更新は8/29か8/30です。


## アプリケーション利用準備と、アプリケーションのビルド
本アプリケーションの動作にはNode.jsとnpmが必要です。  
まず、node.jsをインストールしてください。

### STEP1: `git clone https://github.com/taichimurakami-github/applications.git`
まず、git cloneにて必要ファイルをコピーしましょう。

### STEP2: `npm i`
必要なモジュールをインストールします。この手順を飛ばすとSTEP3のビルドでエラーが出ます。

### STEP3: `npm run build`
アプリケーションをビルドします。  
distフォルダが作成され、その中に**attendance-management Setup (version number).exe**というファイルが作成されれば成功です。  
なお、もしビルドに失敗している場合、以下の点を参照してください。  

～エラーが出た時は～  
以下の点を確認してください。  

+ package.json
json内の"main"の項目が以下の設定になっているか確認してください。  
`"main": "build/electron/main.js"`  
もし"public/electron/main.js"の場合、上記で上書きしてください。　　

+ 実行コマンドの変更  
OS依存のシェルコマンド(&等)を利用したスクリプトがある関係上、何らかのエラーが発生することがあります。  
`npm-run-all`等を試してみてください。  

+ dependenciesとdevDependenciesのパッケージがどちらも正しくインストールされているか  
devDependenciesのパッケージを使ってビルドを行います。


## アプリケーションのインストールと実行

### STEP1: Setup.exeを起動
先ほどのSTEP4で作成したsetup.exeをクリックし、インストールしてください。  

### STEP2: アプリを起動
windowsの場合、インストール完了後にデスクトップにアプリのショートカットアイコンが追加されます。それをクリックすると、アプリが起動できます。  

なお、アプリ本体のexeファイルは以下のパス内に保存されています。  
`~\AppData\Local\Programs\attendance-management\attendance-management.exe`

その他、実行可能なnpmコマンドがいくつかあります。詳細はpackage.jsonを確認してください。

## アプリケーションの仕様
### 構成
package.jsonを参照のこと

### アプリケーション起動時
**`~\AppData\Roaming\attendance-management`**  

フォルダ内に、

+ アプリ内ローカルデータ(設定ファイル、出席記録、アプリケーション状態のバックアップファイル)
+ アプリ本体とその他ビルド関係のファイル

が出力されています。  
アプリ内ローカルデータは以下のディレクトリに保存されています。  

**`~\AppData\Roaming\attendance-management\appLocalData\`**  

このフォルダ内の構造は、以下のようになっています。  

+ config.json  
+ attendance/ (年度)(月)(日).json    
+ seats/ (年度)(月)(日).json   

#### config.jsonについて
アプリケーションの状態をローカルで保存するためのファイルです。基本的にいじらないでください。  
書き出しはアプリケーション側から自動的に行われます。  
主に外部ファイルの書き出し先、あるいは必要データの読み込み先のパスなどが格納されています。

#### attendanceフォルダについて  
生徒の出席記録をjson形式で出力するフォルダです。  
ファイル名は、アプリを使用した年度と日付となります。  
なお、JSの仕様上、日付は一桁でも "0" が入りません。  

+ ex) 2021年8月2日に使用した場合："202182.json"というファイルが作成される  

**出席記録を統計処理する際は、このディレクトリを参照してください。**

#### seatsフォルダについて
アプリケーションの内部状態のバックアップとなるデータを格納します。いじらないでください。

## 不具合などの対応
### version 0.9.5
1. バックアップファイル読み込み時に不具合がある(？)  
日付をまたいで、バックアップファイルが一新されるタイミングで何らかの不具合が起こることがあります。  
再現性がないため、現在検証中です。キャッシュ関係の可能性もあるため、アプリの再インストールを行ってください。  
なお、再インストールを行っても出席データなどは削除されません。